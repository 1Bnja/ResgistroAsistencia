version: '3.8'

services:
  backup-service:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: backup-service
    env_file:
      - .env
    environment:
      - MONGODB_URI=${MONGODB_URI}
      - MONGODB_WRITE_URI=${MONGODB_WRITE_URI}
      - MONGODB_DB_NAME=${MONGODB_DB_NAME:-asistencia_db}
      - RETENTION_DAYS=${RETENTION_DAYS:-7}
    volumes:
      # Volumen para backups de MongoDB
      - backup-mongodb:/backups/mongodb
      # Volumen para backups de archivos
      - backup-files:/backups/files
      # Volumen para logs
      - backup-logs:/backups/logs
      # Volumen externo (opcional - descomentar si tienes almacenamiento externo)
      # - /mnt/external_backup:/mnt/external_backup
      # Acceso a volúmenes de la aplicación para backup de archivos
      - ../../services/notification-service/logs:/app/logs:ro
      # Agregar más volúmenes según necesites
    networks:
      - backup-network
    restart: unless-stopped

volumes:
  backup-mongodb:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ./backups/mongodb
  
  backup-files:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ./backups/files
  
  backup-logs:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ./backups/logs

networks:
  backup-network:
    driver: bridge
